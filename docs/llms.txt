# TSENAT: Tsallis Entropy Analysis Toolbox

TSENAT analyze expression/transcript differences and compute diversity
metrics.

## Tsallis theory

Tsallis entropy generalizes Shannon entropy. For a probability vector
$`p = (p_1, \dots, p_n)`$ (with $`p_i \ge 0`$ and $`\sum_i p_i = 1`$)
the Tsallis entropy of order $`q`$ is defined for $`q \ne 1`$ as

``` math
S_q(p) = \frac{1 - \sum_{i} p_i^q}{q - 1}.
```

In the limit $`q \to 1`$ this recovers the Shannon entropy

``` math
\lim_{q \to 1} S_q(p) = -\sum_i p_i \log p_i.
```

In transcript-expression data we compute Tsallis entropy per gene from
the isoform-level relative abundances. For a gene with isoform counts or
expression values x_i, convert to proportions

``` math
p_i = x_i / \sum_j x_j
```

so that $`p_i \ge 0`$ and $`\sum_i p_i = 1`$. The parameter `q` tunes
what aspect of isoform usage the entropy emphasizes: values $`q<1`$
increase the influence of low-abundance (rare) isoforms, while $`q>1`$
increases the influence of high-abundance (dominant) isoforms. Practical
examples: `q = 0` corresponds to isoform richness (the number of
expressed isoforms), `q \approx 1` recovers Shannon entropy (uncertainty
of isoform usage), and `q = 2` is closely related to the inverse Simpson
index (sensitive to dominance).

Practical recommendations: compute `p_i` from gene-wise-normalized
values (e.g. TPM, CPM or counts normalized per gene) before applying
`S_q`; you may filter very low-count isoforms or add a small pseudocount
if zeros cause instability. Always compare `S_q` values computed with
the same `q` and the same normalization. Computing `S_q` over a range of
`q` (a “q-curve”) is especially useful — it shows whether diversity
differences between samples are driven by rare isoforms (differences at
low `q`) or by changes in dominant isoforms (differences at high `q`).

## Integrated features

- Tsallis entropy and diversity calculations:
  - `calculate_tsallis_entropy`: computes S_q and/or D_q for a numeric
    vector of expression values (supports normalization, multiple `q`
    values and the q→1 limit). Returns numeric vectors or a list
    depending on `what`.
  - `calculate_diversity`: applies the calculation across
    transcripts/genes for matrices, `tximport`-style lists or
    `SummarizedExperiment` objects and returns a `SummarizedExperiment`
    with assay `diversity` (S_q) or `hill` (D_q).
- Differential and statistical analyses:
  - `calculate_difference` and helpers in `difference_functions` compute
    group means, differences (or log2 fold-changes), p-values and
    adjusted p-values. These functions are designed to work with
    diversity summaries as well as expression matrices.
- Plotting and visualization:
  - `plot_tsallis_q_curve`: median ± IQR of Tsallis entropy across
    q-values by group.

## Installation and documentation

Install from GitHub during development:

``` r

if (!requireNamespace("remotes", quietly = TRUE)) install.packages("remotes")
remotes::install_github("gallardoalba/TSENAT")

## Recommended (reproducible): use `renv`.

install.packages("renv")
renv::init()
# when dependencies are set, record lock
renv::snapshot()
```

## Quick start

Compute Tsallis diversity for a single `q` and plot a q-curve across
multiple `q` values (small, focused example taken from the vignette):

``` r

library(TSENAT)
data("tcga_brca_luma_dataset", package = "TSENAT")

# compute for q = 0.1 and normalize
readcounts <- tcga_brca_luma_dataset$counts
genes <- tcga_brca_luma_dataset$gene
ts_se <- calculate_diversity(readcounts, genes, method = "tsallis", q = 0.1, norm = TRUE)

# compute for multiple q values and plot the q-curve
qvec <- seq(0.01, 2, by = 0.1)
ts_multi <- calculate_diversity(readcounts, genes, method = "tsallis", q = qvec, norm = TRUE)
plot_tsallis_q_curve(ts_multi, group = colData(ts_multi)$sample_type)
```

![q-curve example](articles/TSENAT_files/figure-html/plot-q-curve-1.png)

q-curve example

## Licence, citation and atribution

This project is licensed under the GNU General Public License v3.0
(GPL-3). A copy of the full license text is included in the repository
at `LICENSE` and is installed with the package under `inst/LICENSE`.

To cite TSENAT in publications, run the following in R:

``` r

citation("TSENAT")
```

This command shows the recommended bibliographic entry; a
machine-readable `inst/CITATION` file is included with the package for
easy citation export.

TSENAT builds upon and adapts substantial portions of code from the
[SplicingFactory package](https://github.com/esebesty/SplicingFactory).
The codebase has been extended with additional utilities, bug fixes and
plotting helpers focused on Tsallis based transcript-level diversity
analysis.

# Package index

## All functions

- [`calculate_difference()`](https://gallardoalba.github.io/TSENAT/reference/calculate_difference.md)
  : Calculate splicing diversity changes between two conditions.
- [`calculate_diversity()`](https://gallardoalba.github.io/TSENAT/reference/calculate_diversity.md)
  : Calculate Tsallis diversity per gene across samples
- [`calculate_fc()`](https://gallardoalba.github.io/TSENAT/reference/calculate_fc.md)
  : Calculate splicing diversity changes between two conditions.
- [`calculate_lm_interaction()`](https://gallardoalba.github.io/TSENAT/reference/calculate_lm_interaction.md)
  : Linear-model interaction test for Tsallis entropy
- [`calculate_method()`](https://gallardoalba.github.io/TSENAT/reference/calculate_method.md)
  : Calculate Tsallis diversity values for transcripts grouped by gene
- [`calculate_tsallis_entropy()`](https://gallardoalba.github.io/TSENAT/reference/calculate_tsallis_entropy.md)
  : Calculate Tsallis entropy for a vector of transcript-level
  expression values of one gene.
- [`infer_sample_group()`](https://gallardoalba.github.io/TSENAT/reference/infer_sample_group.md)
  : Infer sample group from sample names
- [`label_shuffling()`](https://gallardoalba.github.io/TSENAT/reference/label_shuffling.md)
  : Calculate p-values using label shuffling.
- [`map_coldata_to_se()`](https://gallardoalba.github.io/TSENAT/reference/map_coldata_to_se.md)
  : Map external coldata into a SummarizedExperiment
- [`plot_diversity_density()`](https://gallardoalba.github.io/TSENAT/reference/plot_diversity_density.md)
  : Plot diversity distributions (density) by sample type
- [`plot_ma()`](https://gallardoalba.github.io/TSENAT/reference/plot_ma.md)
  : Plot MA plot for difference results
- [`plot_mean_violin()`](https://gallardoalba.github.io/TSENAT/reference/plot_mean_violin.md)
  : Plot violin of per-gene mean diversity by sample type
- [`plot_top_transcripts`](https://gallardoalba.github.io/TSENAT/reference/plot_top_transcripts.md)
  : Plot top transcripts for a gene
- [`plot_tsallis_density_multq()`](https://gallardoalba.github.io/TSENAT/reference/plot_tsallis_density_multq.md)
  : Density plot of Tsallis entropy for multiple q values
- [`plot_tsallis_q_curve()`](https://gallardoalba.github.io/TSENAT/reference/plot_tsallis_q_curve.md)
  : Plot median +- IQR of Tsallis entropy across q values by group
- [`plot_tsallis_violin_multq()`](https://gallardoalba.github.io/TSENAT/reference/plot_tsallis_violin_multq.md)
  : Violin plot of Tsallis entropy for multiple q values
- [`plot_volcano()`](https://gallardoalba.github.io/TSENAT/reference/plot_volcano.md)
  : Volcano plot for differential results
- [`tcga_brca_luma_dataset`](https://gallardoalba.github.io/TSENAT/reference/tcga_brca_luma_dataset.md)
  : TCGA Luminal A breast cancer dataset
- [`wilcoxon()`](https://gallardoalba.github.io/TSENAT/reference/wilcoxon.md)
  : Calculate p-values using Wilcoxon rank sum test.

# Articles

### All vignettes

- [TSENAT: Tsallis entropy
  workflow](https://gallardoalba.github.io/TSENAT/articles/TSENAT.md):
