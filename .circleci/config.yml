version: 2.1
jobs:
  build:
    docker:
      - image: rocker/r-ver:4.2.2
    working_directory: ~/repo
    steps:
      - checkout
      - run:
          name: Install OS deps
          command: |
            apt-get update && apt-get install -y --no-install-recommends \
              libxml2-dev libssl-dev libcurl4-openssl-dev libgit2-dev
      - run:
          name: Install R tools
          command: R -e 'install.packages(c("remotes","devtools","rcmdcheck"), repos="https://cloud.r-project.org")'
      - run:
          name: Build package
          command: R CMD build .
      - run:
          name: Run checks
          command: R CMD check --no-manual *.tar.gz
