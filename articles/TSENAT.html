<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>TSENAT: Tsallis Entropy Analysis Toolbox • TSENAT</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="TSENAT: Tsallis Entropy Analysis Toolbox">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">TSENAT</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../index.html"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html"><span class="fa far fa-file-code fa-lg"></span> Functions</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gallardoalba/TSENAT"><span class="fa fab fa-github fa-lg"></span> Source Code</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gallardoalba/TSENAT/issues"><span class="fa fas fa-question-circle fa-lg"></span> Issues</a></li>
<li class="nav-item"><a class="nav-link" href="../articles/index.html"><span class="fa fas fa-file-contract fa-lg"></span> Vignettes</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-vignette-files" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true"><span class="fa fas fa-book fa-lg"></span> Vignette Files</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-vignette-files">
<li><a class="dropdown-item" href="../articles/TSENAT.pdf">PDF (vignette)</a></li>
    <li><a class="dropdown-item" href="../articles/TSENAT.html">HTML (vignette)</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gallardoalba/TSENAT/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>TSENAT: Tsallis Entropy Analysis Toolbox</h1>
                        <h4 data-toc-skip class="author">Cristóbal
Gallardo <a href="mailto:gallardoalba@pm.me" class="email">gallardoalba@pm.me</a>
</h4>
            
            <h4 data-toc-skip class="date">2026-02-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/gallardoalba/TSENAT/blob/HEAD/vignettes/TSENAT.Rmd" class="external-link"><code>vignettes/TSENAT.Rmd</code></a></small>
      <div class="d-none name"><code>TSENAT.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette demonstrates how to compute and apply Tsallis entropy
to transcript-level expression data using <code>TSENAT</code>. It
focuses on three practical goals: (1) compute per-sample, per-gene
diversity measures across a range of sensitivity parameters
<code>q</code>; (2) compare those measures between sample groups; and
(3) visualize and inspect transcript-level patterns that explain
differences.</p>
<div class="section level3">
<h3 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h3>
<p>Many genes express multiple isoforms whose relative abundances can be
multimodal or heavy-tailed. Standard mean-based comparisons may miss
changes in isoform dominance or heterogeneity. Tsallis entropy provides
a tunable way to weight rare versus dominant isoforms by varying
<code>q</code>, producing a “q-curve” that reveals scale-dependent
diversity differences.</p>
</div>
<div class="section level3">
<h3 id="high-level-workflow">High-level workflow<a class="anchor" aria-label="anchor" href="#high-level-workflow"></a>
</h3>
<ol style="list-style-type: decimal">
<li>Preprocess counts and filter low-abundance transcripts.</li>
<li>Compute relative transcript proportions within each gene and
evaluate Tsallis entropy across one or more <code>q</code> values.</li>
<li>Summarize per-gene values across samples (mean/median) and test for
differences between groups (Wilcoxon or permutations).</li>
<li>Visualize q-curves and inspect transcript-level counts for top
genes.</li>
</ol>
</div>
</div>
<div class="section level2">
<h2 id="what-is-tsallis-entropy">What is Tsallis entropy?<a class="anchor" aria-label="anchor" href="#what-is-tsallis-entropy"></a>
</h2>
<p>Tsallis entropy is a one-parameter family of diversity measures that
generalizes Shannon entropy via a sensitivity parameter <code>q</code>.
For a discrete probability vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>=</mo><mo stretchy="false" form="prefix">(</mo><msub><mi>p</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>p</mi><mi>n</mi></msub><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">p=(p_1,\dots,p_n)</annotation></semantics></math>
it is defined as</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mi>q</mi></msub><mo stretchy="false" form="prefix">(</mo><mi>p</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mfrac><mrow><mn>1</mn><mo>−</mo><munderover><mo>∑</mo><mrow><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></munderover><msubsup><mi>p</mi><mi>i</mi><mi>q</mi></msubsup></mrow><mrow><mi>q</mi><mo>−</mo><mn>1</mn></mrow></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
S_q(p) = \frac{1-\sum_{i=1}^n p_i^q}{q-1}.
</annotation></semantics></math></p>
<p>Why use Tsallis entropy for gene-expression data?</p>
<p>Tsallis entropy provides a compact, flexible summary of isoform-level
heterogeneity that is particularly useful when biological signals act at
different abundance scales; combined with careful preprocessing and
resampling-based uncertainty quantification it is a practical and
interpretable tool for transcriptomics analyses. Key advantages:</p>
<ul>
<li>
<strong>Tunable sensitivity</strong>: changing <code>q</code> shifts
emphasis between rare and dominant isoforms. Use small <code>q</code>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&lt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">&lt;1</annotation></semantics></math>)
to probe rare-isoform heterogeneity and larger <code>q</code>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>&gt;</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">&gt;1</annotation></semantics></math>)
to focus on dominant-isoform behaviour; plotting <code>S_q</code> across
a compact <code>q</code> grid (a “q-curve”) reveals scale-dependent
differences between conditions.</li>
<li>
<strong>Interpretability</strong>: Tsallis maps to several familiar
indices in limits (Shannon at <code>q=1</code>, richness-like at
<code>q=0</code>, Gini–Simpson at <code>q=2</code>), so it unifies
multiple perspectives on isoform diversity within one framework.</li>
<li>
<strong>Robust summary and diagnostics</strong>: combined with Hill
numbers and q-curves, <code>S_q</code> supports concise reporting
(effective isoform counts, slope/AUC summaries) and targeted follow-up
(transcript-level plots).</li>
</ul>
<p><strong>Essential limiting cases</strong>:</p>
<ul>
<li>Limit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo>→</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">q\to 1</annotation></semantics></math>:
Shannon entropy,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mrow><mi mathvariant="normal">lim</mi><mo>⁡</mo></mrow><mrow><mi>q</mi><mo>→</mo><mn>1</mn></mrow></msub><msub><mi>S</mi><mi>q</mi></msub><mo stretchy="false" form="prefix">(</mo><mi>p</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mi>−</mi><msub><mo>∑</mo><mi>i</mi></msub><msub><mi>p</mi><mi>i</mi></msub><mrow><mi mathvariant="normal">log</mi><mo>⁡</mo></mrow><msub><mi>p</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\lim_{q\to1} S_q(p) = -\sum_i p_i\log
p_i</annotation></semantics></math>.</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">q=0</annotation></semantics></math>:
richness-like (number of expressed isoforms minus one).</li>
<li>
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">q=2</annotation></semantics></math>:
Gini–Simpson / collision index,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mn>2</mn></msub><mo>=</mo><mn>1</mn><mo>−</mo><msub><mo>∑</mo><mi>i</mi></msub><msubsup><mi>p</mi><mi>i</mi><mn>2</mn></msubsup></mrow><annotation encoding="application/x-tex">S_2 = 1-\sum_i p_i^2</annotation></semantics></math>.</li>
<li>Uniform maximum: for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>
expressed isoforms,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>S</mi><mrow><mi>q</mi><mo>,</mo><mi mathvariant="normal">max</mi></mrow></msub><mo stretchy="false" form="prefix">(</mo><mi>m</mi><mo stretchy="false" form="postfix">)</mo><mo>=</mo><mfrac><mrow><mn>1</mn><mo>−</mo><msup><mi>m</mi><mrow><mn>1</mn><mo>−</mo><mi>q</mi></mrow></msup></mrow><mrow><mi>q</mi><mo>−</mo><mn>1</mn></mrow></mfrac></mrow><annotation encoding="application/x-tex">S_{q,\max}(m)=\frac{1-m^{1-q}}{q-1}</annotation></semantics></math>
and normalized
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>S</mi><mo accent="true">̃</mo></mover><mi>q</mi></msub><mo>=</mo><msub><mi>S</mi><mi>q</mi></msub><mi>/</mi><msub><mi>S</mi><mrow><mi>q</mi><mo>,</mo><mi mathvariant="normal">max</mi></mrow></msub><mo stretchy="false" form="prefix">(</mo><mi>m</mi><mo stretchy="false" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">\tilde S_q = S_q / S_{q,\max}(m)</annotation></semantics></math>.</li>
</ul>
<p><strong>Use cases and interpretation</strong>:</p>
<p>A gene with group separation only at low <code>q</code> suggests
differences in low-abundance (rare) isoforms; separation at high
<code>q</code> indicates changes in dominant isoforms. When both regimes
differ, the q-curve will show divergence across the entire
<code>q</code> range.</p>
<p>Report <code>S_q</code> or Hill numbers <code>D_q</code> as
appropriate for clarity: <code>D_q</code> converts entropies into an
“effective number of isoforms” that is easy to interpret.</p>
</div>
<div class="section level2">
<h2 id="example-dataset">Example dataset<a class="anchor" aria-label="anchor" href="#example-dataset"></a>
</h2>
<p>An example dataset is included for demonstration. Load the package
and data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load packages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gallardoalba.github.io/TSENAT">TSENAT</a></span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://bioconductor.org/packages/SummarizedExperiment" class="external-link">SummarizedExperiment</a></span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="sample-naming-and-pairing-requirements">Sample naming and pairing requirements<a class="anchor" aria-label="anchor" href="#sample-naming-and-pairing-requirements"></a>
</h3>
<p>TSENAT requires a consistent, exact mapping between the assay column
names and the values in <code>coldata$Sample</code>. The following rules
and recommendations make mapping reliable and avoid surprises when
running paired analyses.</p>
<ul>
<li>Naming convention: for paired comparisons use a shared base
identifier and a role suffix, e.g. <code>SAMPLE_N</code> /
<code>SAMPLE_T</code> or <code>SAMPLE_Normal</code> /
<code>SAMPLE_Tumor</code>. The helper <code>infer_sample_group()</code>
recognizes common underscore suffixes (like <code>_N</code> /
<code>_T</code>) and common TCGA-style tokens.</li>
<li>Validation and metadata: to perform paired analyses call
<code>map_coldata_to_se(..., paired = TRUE)</code>. When
<code>paired = TRUE</code> the function will reorder columns to follow
<code>coldata</code>, add <code>sample_type</code> and
<code>sample_base</code> to <code>colData(ts_se)</code>, and check that
each <code>sample_base</code> has entries for all groups, returning an
informative error if not.</li>
</ul>
<p>The following example from <code>coldata_df</code> illustrates a
correct format:</p>
<pre class="text"><code>Sample  Condition
TCGA-A7-A0CH_N  Normal
TCGA-A7-A0D9_N  Normal
TCGA-A7-A0CH_T  Tumor
TCGA-A7-A0D9_T  Tumor</code></pre>
</div>
<div class="section level3">
<h3 id="load-data-and-metadata">Load data and metadata<a class="anchor" aria-label="anchor" href="#load-data-and-metadata"></a>
</h3>
<p>Now we load the example dataset and associated metadata:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load required files</span></span>
<span><span class="va">coldata_tsv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"coldata.tsv"</span>, package <span class="op">=</span> <span class="st">"TSENAT"</span><span class="op">)</span></span>
<span><span class="va">tx2gene_tsv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"tx2gene.tsv"</span>, package <span class="op">=</span> <span class="st">"TSENAT"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"tcga_brca_luma_dataset"</span>, package <span class="op">=</span> <span class="st">"TSENAT"</span>, envir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html" class="external-link">globalenv</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract gene names and read count data (do not reference ts_se yet)</span></span>
<span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="va">tcga_brca_luma_dataset</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="va">readcounts</span> <span class="op">&lt;-</span> <span class="va">tcga_brca_luma_dataset</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Assign transcript IDs as rownames of `readcounts`</span></span>
<span><span class="co"># so downstream transcript-level plotting functions can use them.</span></span>
<span><span class="va">txmap</span> <span class="op">&lt;-</span> <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.delim</a></span><span class="op">(</span><span class="va">tx2gene_tsv</span>, header <span class="op">=</span> <span class="cn">TRUE</span>, stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">readcounts</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">txmap</span><span class="op">$</span><span class="va">Transcript</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Read sample metadata</span></span>
<span><span class="va">coldata_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.table</a></span><span class="op">(</span><span class="va">coldata_tsv</span>,</span>
<span>    header <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    sep <span class="op">=</span> <span class="st">"\t"</span>,</span>
<span>    stringsAsFactors <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The next step is to inspect the loaded data to ensure it looks
correct.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check gene names</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">genes</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "MXRA8"   "MXRA8"   "MXRA8"   "MXRA8"   "MXRA8"   "C1orf86"</span></span>
<span></span>
<span><span class="co"># Check read count dataset</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">readcounts</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1100   40</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">readcounts</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;           TCGA-A7-A0CH_N TCGA-A7-A0CH_T TCGA-A7-A0D9_N TCGA-A7-A0D9_T</span></span>
<span><span class="co">#&gt; MXRA8.1          2858.04         743.56         812.59           0.00</span></span>
<span><span class="co">#&gt; MXRA8.2           127.82          21.28          50.87          38.21</span></span>
<span><span class="co">#&gt; MXRA8.3           370.22          94.38         368.76          98.12</span></span>
<span><span class="co">#&gt; MXRA8.4          7472.00        3564.87        7647.76        3236.28</span></span>
<span><span class="co">#&gt; MXRA8.5            25.44          16.91           4.07           7.55</span></span>
<span><span class="co">#&gt; C1orf86.1           0.00           0.00           0.00           0.00</span></span>
<span><span class="co">#&gt;           TCGA-A7-A0DB_T</span></span>
<span><span class="co">#&gt; MXRA8.1          1508.90</span></span>
<span><span class="co">#&gt; MXRA8.2            30.10</span></span>
<span><span class="co">#&gt; MXRA8.3           167.89</span></span>
<span><span class="co">#&gt; MXRA8.4          6360.80</span></span>
<span><span class="co">#&gt; MXRA8.5            34.74</span></span>
<span><span class="co">#&gt; C1orf86.1           0.00</span></span>
<span></span>
<span><span class="co"># Check the metadata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">coldata_df</span><span class="op">)</span></span>
<span><span class="co">#&gt;           Sample Condition</span></span>
<span><span class="co">#&gt; 1 TCGA-A7-A0CH_N    Normal</span></span>
<span><span class="co">#&gt; 2 TCGA-A7-A0D9_N    Normal</span></span>
<span><span class="co">#&gt; 3 TCGA-A7-A0DB_N    Normal</span></span>
<span><span class="co">#&gt; 4 TCGA-A7-A0DC_N    Normal</span></span>
<span><span class="co">#&gt; 5 TCGA-A7-A13G_N    Normal</span></span>
<span><span class="co">#&gt; 6 TCGA-AC-A2FB_N    Normal</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-filtering-and-preprocessing">Data filtering and preprocessing<a class="anchor" aria-label="anchor" href="#data-filtering-and-preprocessing"></a>
</h3>
<p>As a first step, before doing the diversity calculation, you might
want to filter out genes with a low overall expression or limit the
analysis to transcripts with a sufficient minimum expression level.
Expression estimates of transcript isoforms with zero or low expression
might be highly variable. For more details on the effect of transcript
isoform prefiltering on differential transcript usage, see <a href="https://doi.org/10.1186/s13059-015-0862-3" class="external-link">this paper</a>.</p>
<p>Filter transcripts with fewer than 5 reads in more than 5 samples and
update the <code>genes</code> vector accordingly.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Filter lowly-expressed transcripts and report counts</span></span>
<span><span class="va">n_before</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">readcounts</span><span class="op">)</span></span>
<span><span class="va">tokeep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/MatrixGenerics/man/rowSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">readcounts</span> <span class="op">&gt;</span> <span class="fl">5</span><span class="op">)</span> <span class="op">&gt;</span> <span class="fl">5</span></span>
<span><span class="va">readcounts</span> <span class="op">&lt;-</span> <span class="va">readcounts</span><span class="op">[</span><span class="va">tokeep</span>, <span class="op">]</span></span>
<span><span class="va">genes</span> <span class="op">&lt;-</span> <span class="va">genes</span><span class="op">[</span><span class="va">tokeep</span><span class="op">]</span></span>
<span><span class="va">n_after</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">readcounts</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">message</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span></span>
<span>    <span class="st">"Transcripts: before = %d, after = %d"</span>,</span>
<span>    <span class="va">n_before</span>, <span class="va">n_after</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Transcripts: before = 1100, after = 833</span></span></code></pre></div>
<p>We filter lowly-expressed transcripts to reduce noise and improve the
stability of diversity estimates.</p>
</div>
</div>
<div class="section level2">
<h2 id="compute-normalized-tsallis-entropy-">Compute normalized Tsallis entropy.<a class="anchor" aria-label="anchor" href="#compute-normalized-tsallis-entropy-"></a>
</h2>
<p>Compute Tsallis entropy for a single <code>q</code> and inspect the
resulting assay.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute Tsallis entropy for a single q value (normalized)</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fl">0.1</span></span>
<span><span class="va">ts_se</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_diversity.html">calculate_diversity</a></span><span class="op">(</span><span class="va">readcounts</span>, <span class="va">genes</span>, q <span class="op">=</span> <span class="va">q</span>, norm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">ts_se</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;         TCGA-A7-A0CH_N TCGA-A7-A0CH_T TCGA-A7-A0D9_N TCGA-A7-A0D9_T</span></span>
<span><span class="co">#&gt; MXRA8        0.8616275      0.6609111      0.8156972      0.6633580</span></span>
<span><span class="co">#&gt; C1orf86      0.0000000      0.0000000      0.0000000      0.0000000</span></span>
<span><span class="co">#&gt; PDPN         0.3486679      0.3395884      0.0000000      0.3481643</span></span>
<span><span class="co">#&gt; ALDH4A1      0.8111864      0.4667361      0.8621495      0.5069312</span></span>
<span><span class="co">#&gt; HNRNPR       0.5204909      0.6683829      0.7395887      0.6537834</span></span>
<span><span class="co">#&gt;         TCGA-A7-A0DB_T</span></span>
<span><span class="co">#&gt; MXRA8        0.8036333</span></span>
<span><span class="co">#&gt; C1orf86      0.0000000</span></span>
<span><span class="co">#&gt; PDPN         0.3467400</span></span>
<span><span class="co">#&gt; ALDH4A1      0.5046596</span></span>
<span><span class="co">#&gt; HNRNPR       0.8287792</span></span></code></pre></div>
<p>Now we should map the sample metadata (if available) into the
<code>SummarizedExperiment</code> so plotting functions can use
<code>sample_type</code> for grouping.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_se</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_coldata_to_se.html">map_coldata_to_se</a></span><span class="op">(</span><span class="va">ts_se</span>, <span class="va">coldata_df</span>, paired <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>After mapping, inspect <code>colData(ts_se)</code> to confirm
<code>sample_type</code> and <code>sample_base</code> are present and
correctly populated.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Quick checks on mapped sample metadata</span></span>
<span><span class="va">cd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">ts_se</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">cd</span><span class="op">)</span> <span class="co"># list available metadata columns</span></span>
<span><span class="co">#&gt; [1] "samples"     "sample_type" "sample_base"</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cd</span><span class="op">)</span> <span class="co"># preview metadata for first samples</span></span>
<span><span class="co">#&gt; DataFrame with 6 rows and 3 columns</span></span>
<span><span class="co">#&gt;                       samples sample_type    sample_base</span></span>
<span><span class="co">#&gt;                   &lt;character&gt; &lt;character&gt;    &lt;character&gt;</span></span>
<span><span class="co">#&gt; TCGA-A7-A0CH_N TCGA-A7-A0CH_N      Normal TCGA-A7-A0CH_N</span></span>
<span><span class="co">#&gt; TCGA-A7-A0CH_T TCGA-A7-A0CH_T       Tumor TCGA-A7-A0CH_T</span></span>
<span><span class="co">#&gt; TCGA-A7-A0D9_N TCGA-A7-A0D9_N      Normal TCGA-A7-A0D9_N</span></span>
<span><span class="co">#&gt; TCGA-A7-A0D9_T TCGA-A7-A0D9_T       Tumor TCGA-A7-A0D9_T</span></span>
<span><span class="co">#&gt; TCGA-A7-A0DB_N TCGA-A7-A0DB_N      Normal TCGA-A7-A0DB_N</span></span>
<span><span class="co">#&gt; TCGA-A7-A0DB_T TCGA-A7-A0DB_T       Tumor TCGA-A7-A0DB_T</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="differential-analysis">Differential analysis<a class="anchor" aria-label="anchor" href="#differential-analysis"></a>
</h2>
<p>This section summarizes practical guidance for hypothesis testing and
reporting when comparing diversity measures across sample groups.</p>
<p>The package exposes pragmatic pairwise tests for comparing per-gene
diversity summaries between two groups. Two common choices are
Wilcoxon-based tests and label-shuffle tests. Guidance:</p>
<p><strong>Wilcoxon rank-sum (unpaired) / Wilcoxon signed-rank
(paired)</strong>:</p>
<ul>
<li>Use when you want a distribution-free test comparing central
tendency (ranks/median) and sample sizes are moderate (typically ≥10 per
group for stable asymptotic p-values).</li>
<li>Assumptions: independent observations within groups (or matched
pairs for the signed-rank test); exchangeability under the null.</li>
<li>Handle ties: software returns approximate p-values when many ties
exist; consider permutation p-values when ties or discreteness are
extreme (small counts, many zeros).</li>
<li>Report effect sizes (median difference, Hodges–Lehmann estimator)
and confidence intervals where possible; do not rely on p-values
alone.</li>
</ul>
<p><strong>Label-shuffle tests</strong>:</p>
<ul>
<li>Use when sample sizes are small, distributional assumptions are
questionable, or you prefer an exact/empirical null constructed from the
observed data. Randomly shuffle group labels many times and recompute
the test statistic (difference in medians or means).</li>
<li>Exchangeability requirement: permutations are valid when labels are
exchangeable under the null (e.g., independent samples). For paired
designs use paired permutations that shuffle within pairs or use sign
flips for paired differences.</li>
<li>Practical settings: set <code>randomizations</code> to ≥1000 for
routine use and 5000+ when estimating small p-values or when applying
FDR across many genes. When possible, compute exact permutations (all
labelings) for very small datasets.</li>
</ul>
<p>Here we will use the <strong>Wilcoxon test</strong>; it is the
appropriate choice for speed when sample sizes support asymptotic
approximations. Use permutation tests when small-sample accuracy or
exact control of the null distribution is important.</p>
<p><strong>Recommendation: summary &amp; test choice</strong>:</p>
<p>For the analyses shown in this vignette we recommend using the
<strong>median</strong> in the <strong>Wilcoxon</strong> rank-sum test
for comparisons. Tsallis entropy values are often skewed and sensitive
to outliers; the median is robust and the Wilcoxon test does not assume
normality, so this combination is well suited for our analysis.</p>
<p>Before running differential tests we summarize per-gene diversity
values across samples and explicitly define sample groups.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create a sample grouping vector inferred from sample names</span></span>
<span><span class="co"># account for per-q column names like 'Sample_q=0.01'</span></span>
<span><span class="va">sample_base_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span></span>
<span>    <span class="st">"_q=.*"</span>, <span class="st">""</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">ts_se</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">ts_se</span><span class="op">)</span><span class="op">$</span><span class="va">sample_type</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># prepare diversity table as data.frame with gene names in first column</span></span>
<span><span class="va">div_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">ts_se</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">div_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span>genes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">rowData</a></span><span class="op">(</span><span class="va">ts_se</span><span class="op">)</span><span class="op">$</span><span class="va">genes</span>, <span class="va">div_df</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># samples are matched pairs (Normal/Tumor), so use a paired test</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_difference.html">calculate_difference</a></span><span class="op">(</span><span class="va">div_df</span>, <span class="va">samples</span>,</span>
<span>    control <span class="op">=</span> <span class="st">"Normal"</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"median"</span>, test <span class="op">=</span> <span class="st">"wilcoxon"</span>,</span>
<span>    paired <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># sort results by adjusted p-value</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">adjusted_p_values</span><span class="op">)</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="co">#&gt;        genes Tumor_median Normal_median median_difference log2_fold_change</span></span>
<span><span class="co">#&gt; 6   C1orf213    0.0000010     0.9870253       -0.98702427    -19.912727492</span></span>
<span><span class="co">#&gt; 17     S1PR1    0.9931595     0.9993087       -0.00614921     -0.008904999</span></span>
<span><span class="co">#&gt; 87      MBD2    0.5592953     0.0000010        0.55929434     19.093250788</span></span>
<span><span class="co">#&gt; 98      OSR1    0.7933920     0.6636451        0.12974692      0.257621943</span></span>
<span><span class="co">#&gt; 101    GFPT1    0.0000010     0.5834509       -0.58344994    -19.154251821</span></span>
<span><span class="co">#&gt; 126     KIF9    0.5814162     0.3710543        0.21036198      0.647941169</span></span>
<span><span class="co">#&gt;     raw_p_values adjusted_p_values</span></span>
<span><span class="co">#&gt; 6   0.0002357454         0.0269389</span></span>
<span><span class="co">#&gt; 17  0.0007285418         0.0269389</span></span>
<span><span class="co">#&gt; 87  0.0006535852         0.0269389</span></span>
<span><span class="co">#&gt; 98  0.0005801974         0.0269389</span></span>
<span><span class="co">#&gt; 101 0.0008919014         0.0269389</span></span>
<span><span class="co">#&gt; 126 0.0006356242         0.0269389</span></span></code></pre></div>
<p>Generate diagnostic plots to summarize per-gene effect sizes:</p>
<ul>
<li>The <strong>MA plot</strong> shows the relationship between mean
expression and log-fold change, helping to spot genes with large effect
sizes across expression levels.</li>
<li>The <strong>volcano plot</strong> displays effect size versus
significance, useful for highlighting candidates by thresholding
magnitude and adjusted p-value.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># MA plot using helper</span></span>
<span><span class="va">p_ma</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_ma.html">plot_ma</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_ma</span><span class="op">)</span></span></code></pre></div>
<p><img src="TSENAT_files/figure-html/ma-and-volcano-1.png" class="r-plt" alt="" width="768"></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Volcano plot: mean difference vs -log10(adjusted p-value)</span></span>
<span><span class="va">p_volcano</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_volcano.html">plot_volcano</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_volcano</span><span class="op">)</span></span></code></pre></div>
<p><img src="TSENAT_files/figure-html/ma-and-volcano-2.png" class="r-plt" alt="" width="768"></p>
<div class="section level3">
<h3 id="plot-top-3-genes-from-the-single-q-differential-analysis">Plot top 3 genes from the single-q differential analysis<a class="anchor" aria-label="anchor" href="#plot-top-3-genes-from-the-single-q-differential-analysis"></a>
</h3>
<p>Here we visualize transcript-level expression for the most
significant genes identified in the previous step. The
<code><a href="../reference/plot_top_transcripts.html">plot_top_transcripts()</a></code> helper expects transcript-level
counts (rows = transcripts) with rownames matching the
<code>tx2gene</code> mapping. We plot the top three genes by
significance to inspect isoform-level patterns that may explain the
diversity differences.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sig_res</span> <span class="op">&lt;-</span> <span class="va">res</span><span class="op">[</span><span class="va">res</span><span class="op">$</span><span class="va">adjusted_p_values</span> <span class="op">&lt;</span> <span class="fl">0.05</span>, , drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">]</span></span>
<span><span class="va">top_genes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">sig_res</span><span class="op">$</span><span class="va">genes</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">sample_base_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">sub</a></span><span class="op">(</span></span>
<span>    <span class="st">"_q=.*"</span>,</span>
<span>    <span class="st">""</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">ts_se</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">samples_vec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">colData</a></span><span class="op">(</span><span class="va">ts_se</span><span class="op">)</span><span class="op">$</span><span class="va">sample_type</span><span class="op">)</span></span>
<span><span class="co"># Plot using median aggregation</span></span>
<span><span class="va">p_median</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_top_transcripts.html">plot_top_transcripts</a></span><span class="op">(</span><span class="va">readcounts</span>,</span>
<span>    gene <span class="op">=</span> <span class="va">top_genes</span>,</span>
<span>    samples <span class="op">=</span> <span class="va">samples_vec</span>, tx2gene <span class="op">=</span> <span class="va">txmap</span>,</span>
<span>    top_n <span class="op">=</span> <span class="cn">NULL</span>, metric <span class="op">=</span> <span class="st">"median"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_median</span><span class="op">)</span></span></code></pre></div>
<p><img src="TSENAT_files/figure-html/top-transcripts-singleq-1.png" class="r-plt" alt="" width="960"></p>
<p>Now, we will plot the same top genes but using variance aggregation
instead of median. This allows us to see how transcript-level expression
variability differs between groups for these genes.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot using variance aggregation</span></span>
<span><span class="va">p_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_top_transcripts.html">plot_top_transcripts</a></span><span class="op">(</span><span class="va">readcounts</span>,</span>
<span>    gene <span class="op">=</span> <span class="va">top_genes</span>,</span>
<span>    samples <span class="op">=</span> <span class="va">samples_vec</span>, tx2gene <span class="op">=</span> <span class="va">txmap</span>,</span>
<span>    top_n <span class="op">=</span> <span class="cn">NULL</span>, metric <span class="op">=</span> <span class="st">"variance"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_var</span><span class="op">)</span></span></code></pre></div>
<p><img src="TSENAT_files/figure-html/top-transcripts-singleq-variance-1.png" class="r-plt" alt="" width="960"></p>
<p>Using these concrete comparisons will help you distinguish consistent
isoform-level regulation, outlier-driven artifacts, reciprocal isoform
switching, and subgroup heterogeneity.</p>
</div>
</div>
<div class="section level2">
<h2 id="compare-between-q-values">Compare between q values<a class="anchor" aria-label="anchor" href="#compare-between-q-values"></a>
</h2>
<p>Compute normalized Tsallis entropy for two <code>q</code> values (0.1
and 2) to compare scale-dependent behavior.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute Tsallis entropy for q = 1 (normalized)</span></span>
<span><span class="va">q</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">ts_se</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_diversity.html">calculate_diversity</a></span><span class="op">(</span><span class="va">readcounts</span>, <span class="va">genes</span>,</span>
<span>    q <span class="op">=</span> <span class="va">q</span>, norm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">ts_se</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;         TCGA-A7-A0CH_N_q=0.1 TCGA-A7-A0CH_N_q=2 TCGA-A7-A0CH_T_q=0.1</span></span>
<span><span class="co">#&gt; MXRA8              0.8616275          0.6063802            0.6609111</span></span>
<span><span class="co">#&gt; C1orf86            0.0000000          0.0000000            0.0000000</span></span>
<span><span class="co">#&gt; PDPN               0.3486679          0.6619058            0.3395884</span></span>
<span><span class="co">#&gt; ALDH4A1            0.8111864          0.7478309            0.4667361</span></span>
<span><span class="co">#&gt; HNRNPR             0.5204909          0.6176153            0.6683829</span></span>
<span><span class="co">#&gt;         TCGA-A7-A0CH_T_q=2 TCGA-A7-A0D9_N_q=0.1</span></span>
<span><span class="co">#&gt; MXRA8            0.3925463            0.8156972</span></span>
<span><span class="co">#&gt; C1orf86          0.0000000            0.0000000</span></span>
<span><span class="co">#&gt; PDPN             0.5044987            0.0000000</span></span>
<span><span class="co">#&gt; ALDH4A1          0.2841620            0.8621495</span></span>
<span><span class="co">#&gt; HNRNPR           0.6856195            0.7395887</span></span></code></pre></div>
<p>This allows comparison across <code>q</code> for the same gene to
determine whether diversity differences are scale-dependent (for
example, significance at <code>q = 0.1</code> but not at
<code>q = 2</code> suggests rare-isoform-driven changes).</p>
<p>Map optional sample metadata into the multi-q
<code>SummarizedExperiment</code> so plotting helpers have access to
<code>sample_type</code> for grouping.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_se</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_coldata_to_se.html">map_coldata_to_se</a></span><span class="op">(</span><span class="va">ts_se</span>, <span class="va">coldata_df</span><span class="op">)</span></span></code></pre></div>
<p>Create <strong>violin and density plots</strong> summarizing
diversity across multiple <code>q</code> values to show distributional
differences between groups.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_violin</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_tsallis_violin_multq.html">plot_tsallis_violin_multq</a></span><span class="op">(</span><span class="va">ts_se</span>, assay_name <span class="op">=</span> <span class="st">"diversity"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_violin</span><span class="op">)</span></span></code></pre></div>
<p><img src="TSENAT_files/figure-html/plots-1.png" class="r-plt" alt="" width="960"></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_density</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/plot_tsallis_density_multq.html">plot_tsallis_density_multq</a></span><span class="op">(</span><span class="va">ts_se</span>, assay_name <span class="op">=</span> <span class="st">"diversity"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">p_density</span><span class="op">)</span></span></code></pre></div>
<p><img src="TSENAT_files/figure-html/plots-2.png" class="r-plt" alt="" width="960"></p>
</div>
<div class="section level2">
<h2 id="linear-model-interaction-and-shape-tests-for-q-curves">Linear-model interaction and shape tests for q-curves<a class="anchor" aria-label="anchor" href="#linear-model-interaction-and-shape-tests-for-q-curves"></a>
</h2>
<p>Now we will compute normalized Tsallis entropy across a sequence of
<code>q</code> values.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute Tsallis entropy for a sequence of values (normalized)</span></span>
<span><span class="va">qvec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.01</span>, <span class="fl">2</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">ts_se</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_diversity.html">calculate_diversity</a></span><span class="op">(</span><span class="va">readcounts</span>, <span class="va">genes</span>,</span>
<span>    q <span class="op">=</span> <span class="va">qvec</span>, norm <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">ts_se</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co">#&gt;         TCGA-A7-A0CH_N_q=0.01 TCGA-A7-A0CH_N_q=0.11 TCGA-A7-A0CH_N_q=0.21</span></span>
<span><span class="co">#&gt; MXRA8               0.9840684             0.8500785             0.7527194</span></span>
<span><span class="co">#&gt; C1orf86             0.0000000             0.0000000             0.0000000</span></span>
<span><span class="co">#&gt; PDPN                0.3348515             0.3502196             0.3659083</span></span>
<span><span class="co">#&gt; ALDH4A1             0.9759153             0.7976183             0.6982381</span></span>
<span><span class="co">#&gt; HNRNPR              0.5653272             0.5164881             0.4849368</span></span>
<span><span class="co">#&gt;         TCGA-A7-A0CH_N_q=0.31 TCGA-A7-A0CH_N_q=0.41</span></span>
<span><span class="co">#&gt; MXRA8               0.6818220             0.6303117</span></span>
<span><span class="co">#&gt; C1orf86             0.0000000             0.0000000</span></span>
<span><span class="co">#&gt; PDPN                0.3818895             0.3981326</span></span>
<span><span class="co">#&gt; ALDH4A1             0.6447807             0.6181672</span></span>
<span><span class="co">#&gt; HNRNPR              0.4655343             0.4548022</span></span></code></pre></div>
<p>Map the sample metadata into the multi-q
<code>SummarizedExperiment</code> as before.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ts_se</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/map_coldata_to_se.html">map_coldata_to_se</a></span><span class="op">(</span><span class="va">ts_se</span>, <span class="va">coldata_df</span><span class="op">)</span></span></code></pre></div>
<p>With the q-sequence we can produces a q-curve per sample and gene.
These curves show how diversity emphasis shifts from rare to dominant
isoforms as <code>q</code> increases and form the basis for interaction
tests. The q-curve shows entropy as a function of <code>q</code>.
Diverging curves between groups indicate scale-dependent diversity
differences. Separation at low <code>q</code> implies differences in
rare isoforms; separation at high <code>q</code> signals differences in
dominant isoforms.</p>
<p>Plot the <strong>Tsallis q-curve</strong> (entropy vs q) to visualize
how diversity changes with <code>q</code> across sample groups.</p>
<p>#<code>{r tsallis-top-lm-genes, fig.width=12, fig.height=6, echo=FALSE} # Plot top linear-model genes using the exported helper #p_top_lm &lt;- plot_tsallis_top_lm_genes(ts_se, lm_res = lm_res, top_n = 6, assay_name = "diversity", sample_type_col = "sample_type") #print(p_top_lm) #</code></p>
</div>
<div class="section level2">
<h2 id="practical-notes-and-recommendations">Practical notes and recommendations<a class="anchor" aria-label="anchor" href="#practical-notes-and-recommendations"></a>
</h2>
<p>Quick checklist (what to do and why):</p>
<ul>
<li>
<strong>Preprocess</strong>: filter transcripts never observed or
add a small, documented pseudocount (e.g., +1) — this stabilizes
proportions and avoids undefined powers when computing
<code>p_i^q</code>.</li>
<li>
<strong>Choose <code>q</code> grid</strong>: pick a compact set
spanning rare → dominant regimes (suggested: 0.1, 0.5, 1, 1.5, 2). Plot
q-curves to inspect where groups diverge rather than relying on a single
<code>q</code>.</li>
<li>
<strong>Reporting scale</strong>: present Hill numbers
<code>D_q</code> (intuitive “effective isoforms”) and/or normalized
entropy
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>S</mi><mo accent="true">̃</mo></mover><mi>q</mi></msub><annotation encoding="application/x-tex">\tilde S_q</annotation></semantics></math>;
report both effect size (median/mean difference) and variability (CI or
bootstrap SE).</li>
<li>
<strong>Hypothesis testing</strong>: use Wilcoxon for speed
(asymptotic) and label-shuffle (permutation) for small samples or exact
inference. For permutations use <code>randomizations</code> ≥1000 (≥5000
when estimating very small p-values); use paired permutations for
matched designs.</li>
<li>
<strong>Multiple testing</strong>: apply FDR correction
(Benjamini–Hochberg) and show raw/adjusted p-values alongside effect
sizes so readers can judge practical relevance.</li>
<li>
<strong>Interaction testing</strong>: explore slopes/AUC first; use
linear interaction for simple slope differences, GAMs for nonlinear
shapes, and FPCA for fast low-dimensional summaries — always report key
parameters (<code>k</code>, <code>randomizations</code>).</li>
<li>
<strong>Design &amp; technical tips</strong>: prefer paired/matched
designs when available, ensure adequate biological replication, use
accurate quantifiers (Salmon/kallisto or UMI-based methods), and correct
for confounders or include them in models.</li>
<li>
<strong>Design examples</strong>: time-series or longitudinal
sampling to capture dynamics; perturbation gradients (dose–response) to
reveal transitions; single-cell or spatial (UMI-based) to study
heterogeneity; paired/matched designs to control subject-level
variability.</li>
<li>
<strong>Technical checklist</strong>: use accurate transcript
quantifiers, aim for sufficient sequencing depth for isoform inference,
filter or pseudocount low-abundance transcripts, and apply
batch/confounder correction prior to downstream testing. Test across a
compact <code>q</code> grid and report the grid.</li>
</ul>
</div>
<div class="section level2">
<h2 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; R version 4.5.2 (2025-10-31)</span></span>
<span><span class="co">#&gt; Platform: x86_64-conda-linux-gnu</span></span>
<span><span class="co">#&gt; Running under: Ubuntu 22.04.5 LTS</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Matrix products: default</span></span>
<span><span class="co">#&gt; BLAS/LAPACK: /home/nouser/miniconda3/lib/libopenblasp-r0.3.30.so;  LAPACK version 3.12.0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; locale:</span></span>
<span><span class="co">#&gt;  [1] LC_CTYPE=es_ES.UTF-8       LC_NUMERIC=C              </span></span>
<span><span class="co">#&gt;  [3] LC_TIME=de_DE.UTF-8        LC_COLLATE=es_ES.UTF-8    </span></span>
<span><span class="co">#&gt;  [5] LC_MONETARY=de_DE.UTF-8    LC_MESSAGES=es_ES.UTF-8   </span></span>
<span><span class="co">#&gt;  [7] LC_PAPER=de_DE.UTF-8       LC_NAME=C                 </span></span>
<span><span class="co">#&gt;  [9] LC_ADDRESS=C               LC_TELEPHONE=C            </span></span>
<span><span class="co">#&gt; [11] LC_MEASUREMENT=de_DE.UTF-8 LC_IDENTIFICATION=C       </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; time zone: Europe/Berlin</span></span>
<span><span class="co">#&gt; tzcode source: system (glibc)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; attached base packages:</span></span>
<span><span class="co">#&gt; [1] stats4    stats     graphics  grDevices utils     datasets  methods  </span></span>
<span><span class="co">#&gt; [8] base     </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; other attached packages:</span></span>
<span><span class="co">#&gt;  [1] mgcv_1.9-4                  nlme_3.1-168               </span></span>
<span><span class="co">#&gt;  [3] SummarizedExperiment_1.40.0 Biobase_2.70.0             </span></span>
<span><span class="co">#&gt;  [5] GenomicRanges_1.62.1        Seqinfo_1.0.0              </span></span>
<span><span class="co">#&gt;  [7] IRanges_2.44.0              S4Vectors_0.48.0           </span></span>
<span><span class="co">#&gt;  [9] BiocGenerics_0.56.0         generics_0.1.4             </span></span>
<span><span class="co">#&gt; [11] MatrixGenerics_1.22.0       matrixStats_1.5.0          </span></span>
<span><span class="co">#&gt; [13] ggplot2_4.0.2               TSENAT_0.99.0              </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; loaded via a namespace (and not attached):</span></span>
<span><span class="co">#&gt;  [1] gtable_0.3.6        xfun_0.56           bslib_0.10.0       </span></span>
<span><span class="co">#&gt;  [4] htmlwidgets_1.6.4   ggrepel_0.9.6       lattice_0.22-7     </span></span>
<span><span class="co">#&gt;  [7] vctrs_0.7.1         tools_4.5.2         tibble_3.3.1       </span></span>
<span><span class="co">#&gt; [10] pkgconfig_2.0.3     Matrix_1.7-4        RColorBrewer_1.1-3 </span></span>
<span><span class="co">#&gt; [13] S7_0.2.1            desc_1.4.3          lifecycle_1.0.5    </span></span>
<span><span class="co">#&gt; [16] compiler_4.5.2      farver_2.1.2        textshaping_1.0.4  </span></span>
<span><span class="co">#&gt; [19] htmltools_0.5.9     sass_0.4.10         yaml_2.3.12        </span></span>
<span><span class="co">#&gt; [22] pkgdown_2.2.0       pillar_1.11.1       jquerylib_0.1.4    </span></span>
<span><span class="co">#&gt; [25] tidyr_1.3.2         DelayedArray_0.36.0 cachem_1.1.0       </span></span>
<span><span class="co">#&gt; [28] abind_1.4-8         tidyselect_1.2.1    digest_0.6.39      </span></span>
<span><span class="co">#&gt; [31] dplyr_1.1.4         purrr_1.2.1         labeling_0.4.3     </span></span>
<span><span class="co">#&gt; [34] splines_4.5.2       fastmap_1.2.0       grid_4.5.2         </span></span>
<span><span class="co">#&gt; [37] cli_3.6.5           SparseArray_1.10.8  magrittr_2.0.4     </span></span>
<span><span class="co">#&gt; [40] patchwork_1.3.2     S4Arrays_1.10.1     withr_3.0.2        </span></span>
<span><span class="co">#&gt; [43] scales_1.4.0        rmarkdown_2.30      XVector_0.50.0     </span></span>
<span><span class="co">#&gt; [46] otel_0.2.0          ragg_1.5.0          evaluate_1.0.5     </span></span>
<span><span class="co">#&gt; [49] knitr_1.51          viridisLite_0.4.2   rlang_1.1.7        </span></span>
<span><span class="co">#&gt; [52] Rcpp_1.1.1          glue_1.8.0          jsonlite_2.0.0     </span></span>
<span><span class="co">#&gt; [55] R6_2.6.1            systemfonts_1.3.1   fs_1.6.6</span></span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/gallardoalba" class="external-link">Cristóbal Gallardo</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
